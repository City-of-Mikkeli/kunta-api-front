connect

:stop-servers(blocking=true)

set clusterPassword=${clusterPassword}
set clusterMaxHeap=${clusterMaxHeap}
set managementAddress=${managementAddress}
set publicAddress=${publicAddress}
set unsecuredAddress=${unsecuredAddress}

/server-group=main-server-group/jvm=default:write-attribute(name=max-heap-size,value=$clusterMaxHeap)

if (outcome != success) of /system-property=jboss.messaging.cluster.password:read-resource
  /system-property=jboss.messaging.cluster.password:add(value=$clusterPassword)
end-if

echo Ensuring full-ha profile in main server group
/server-group=main-server-group:write-attribute(name=profile,value=full-ha)
/server-group=main-server-group:write-attribute(name=socket-binding-group, value=full-ha-sockets)

echo Remove profile default
if (outcome == success) of /profile=default:read-resource
  /profile=default:remove()
end-if

echo Remove profile full
if (outcome == success) of /profile=full:read-resource
  /profile=full:remove()
end-if

echo Remove profile ha
if (outcome == success) of /profile=ha:read-resource
  /profile=ha:remove()
end-if

echo Remove profile load-balancer
if (outcome == success) of /profile=load-balancer:read-resource
  /profile=load-balancer:remove()
end-if

echo Remove server-three
if (outcome == success) of /host=master/server-config=server-three:read-resource
  /host=master/server-config=server-three:remove()
end-if

echo Remove other-server-group
if (outcome == success) of /server-group=other-server-group:read-resource
  /server-group=other-server-group:remove()
end-if

echo Remove server-two
if (outcome == success) of /host=master/server-config=server-two:read-resource
  /host=master/server-config=server-two:remove()
end-if

echo Remove server-one
if (outcome == success) of /host=master/server-config=server-one:read-resource
  /host=master/server-config=server-one:remove()
end-if

/interface=management:write-attribute(name=inet-address,value=${managementAddress})
/interface=public:write-attribute(name=inet-address,value=${publicAddress})
/interface=unsecured:write-attribute(name=inet-address,value=${unsecuredAddress})